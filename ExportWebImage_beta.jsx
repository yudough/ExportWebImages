/*
<javascriptresource>
<name>ExportWebImage</name>
<menu>automate</menu>
<about>jsxでイメージをjpgかpngでプレビューなしで書き出します。</about>
<category>Qscript</category>
<enableinfo>true</enableinfo>
</javascriptresource>
*/
preferences.rulerUnits=Units.PIXELS;var doc=app.activeDocument,doc,saveFile,folder,fsName,tmpFileName,saveOpt,w,h,res,saveGUI,extType,extTypePNG,extTypeJPG,longSide,unitType,exportDoc,shortSide,longSideNum,exportLongSide,exportShortSide,resizeLong,resizeShort;doc=app.activeDocument;docInfo();saveGUI=new Window("dialog","\u66f8\u304d\u51fa\u3057\u30aa\u30d7\u30b7\u30e7\u30f3",[0,100,402,326]);saveGUI.center();docLongSide();saveGUI.btnPnl=saveGUI.add("panel",[10,10,392,216],"");
saveGUI.btnPnl=saveGUI.add("panel",[29,20,209,163],"\u30b5\u30a4\u30ba\u8a2d\u5b9a");saveGUI.btnPnl=saveGUI.add("panel",[222,20,372,163],"\u62e1\u5f35\u5b50\u8a2d\u5b9a");saveGUI.sText=saveGUI.add("statictext",[40,60,130,80],"\u9577\u8fba\u306e\u30b5\u30a4\u30ba:");saveGUI.longSide=saveGUI.add("edittext",[125,58,195,78],longSide);saveGUI.sText=saveGUI.add("statictext",[86,108,128,118],"\u5358\u4f4d:");saveGUI.rBtn1=saveGUI.add("radiobutton",[125,105,175,125],"px");
saveGUI.rBtn2=saveGUI.add("radiobutton",[125,128,175,148],"%");saveGUI.rBtn1.value=!0;saveGUI.cBox1=saveGUI.add("checkbox",[240,46,312,86],"PNG");saveGUI.cBox2=saveGUI.add("checkbox",[240,80,312,120],"JPG");saveGUI.cBox1.value=!0;saveGUI.okBtn=saveGUI.add("button",[242,170,342,205],"\u3044\u3044\u3068\u601d\u3044\u307e\u3059",{name:"ok"});saveGUI.cancelBtn=saveGUI.add("button",[61,170,161,205],"\u30c0\u30e1\u3067\u3059\u306d",{name:"cancel"});
saveGUI.okBtn.onClick=function(){longSideNum=eval(saveGUI.longSide.text);if(1>longSideNum)return alert("\u9577\u8fba\u306e\u30b5\u30a4\u30ba\u304c\u6b63\u3057\u304f\u5165\u529b\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),!1;saveGUI.rBtn2.value?(unitType="percent",exportDoc=longSideNum):(unitType="px",exportDoc=resizeFix(resizeLong));extTypePNG=saveGUI.cBox1.value;extTypeJPG=saveGUI.cBox2.value;if(!extTypePNG&&!extTypeJPG)return alert("\u62e1\u5f35\u5b50\u304c\u9078\u629e\u3055\u308c\u3066\u304a\u308a\u307e\u305b\u3093\u3002\u3069\u308c\u304b\u4e00\u3064\u4ee5\u4e0a\u30c1\u30a7\u30c3\u30af\u3092\u5165\u308c\u3066\u4e0b\u3055\u3044\u3002"),
!1;saveOption(doc);1==extTypePNG&&(extType="png",saveOpt=exportPNG24(),saveToFile(doc));1==extTypeJPG&&(extType="jpg",saveOpt=exportJPG(),saveToFile(doc));alert(decodeURIComponent(folder.fsName+"\n\u306e\u4e2d\u306b\u66f8\u304d\u51fa\u3057\u307e\u3057\u305f"));revertToSnapshot(doc);saveGUI.close()};saveGUI.cancelBtn.onClick=saveGUI.close();saveGUI.show();var fileName,pngOpt,jpgOpt,gifOpt,hisObj;
function exportPNG24(a){a=new ExportOptionsSaveForWeb;a.format=SaveDocumentType.PNG;a.optimized=!0;a.interlaced=!1;a.PNG8=!1;return a}function exportJPG(a){a=new ExportOptionsSaveForWeb;a.format=SaveDocumentType.JPEG;a.includeProfile=!1;a.interlaced=!1;a.optimized=!0;a.quality=70;a.blur=0;a.matteColor=new RGBColor;a.matteColor.red=255;a.matteColor.green=255;a.matteColor.blue=255;return a}function exportGIF(){gifOpt=new ExportOptionsSaveForWeb;gifOpt.format=SaveDocumentType.COMPUSERVEGIF}
function takeSnapShot(){hisObj=app.activeDocument.activeHistoryState}function revertToSnapshot(){doc.activeHistoryState=hisObj}function docInfo(){w=activeDocument.width.value;h=activeDocument.height.value;res=activeDocument.resolution}
function docLongSide(){if(w>=h)longSide=w,shortSide=h;else if(h>=w)longSide=h,shortSide=w;else return alert("\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u30b5\u30a4\u30ba\u60c5\u5831\u304c\u6b63\u3057\u304f\u53d6\u5f97\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002"),!1}function resizeFix(a){return a=longSideNum/longSide*100}function extTypeCount(){}function splitExt(){fileName=activeDocument.name;return fileName.split(/\.(?=[^.]+$)/)}
function exportFile(){tmpFileName=splitExt(fileName);folder=Folder.selectDialog("\u4fdd\u5b58\u5148\u30d5\u30a9\u30eb\u30c0\u306e\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044");saveFile=new File(folder.fsName+"/"+tmpFileName[0]+"."+extType);takeSnapShot(doc);doc.resizeImage(UnitValue(exportDoc,"percent"),UnitValue(exportDoc,"percent"),res,ResampleMethod.BICUBIC);doc.exportDocument(saveFile,ExportType.SAVEFORWEB,saveOpt);revertToSnapshot(doc);alert(decodeURIComponent(saveFile+"\n\u306b\u66f8\u304d\u51fa\u3057\u307e\u3057\u305f"))}
function saveOption(){takeSnapShot(doc);tmpFileName=splitExt(fileName);folder=Folder.selectDialog("\u4fdd\u5b58\u5148\u30d5\u30a9\u30eb\u30c0\u306e\u9078\u629e\u3057\u3066\u304f\u3060\u3055\u3044")}function saveToFile(){saveFile=new File(folder.fsName+"/"+tmpFileName[0]+"."+extType);doc.resizeImage(UnitValue(exportDoc,"percent"),UnitValue(exportDoc,"percent"),res,ResampleMethod.BICUBIC);doc.exportDocument(saveFile,ExportType.SAVEFORWEB,saveOpt)};